openapi: 3.0.1
info:
  title: Leads Core API
  description: |
    Комплексное API для управления виджетами лидогенерации.

    Сервис предоставляет возможности для:
    - Создания и управления виджетами
    - Сбора форм и событий от виджетов
    - Получения статистики и аналитики
    - Мониторинга состояния системы

    ## Аутентификация

    API использует JWT токены для аутентификации. Токен должен быть передан в заголовке Authorization:
    ```
    Authorization: Bearer <jwt_token>
    ```

    ## Пагинация

    Многие эндпоинты поддерживают пагинацию с параметрами:
    - `page` - номер страницы (по умолчанию 1)
    - `per_page` или `limit` - количество элементов на странице (по умолчанию 20, максимум 100)

    ## Коды ответов

    - `200` - Успешный запрос
    - `201` - Ресурс создан
    - `204` - Успешный запрос без содержимого
    - `400` - Ошибка валидации или неверный запрос
    - `401` - Не авторизован
    - `403` - Доступ запрещен
    - `404` - Ресурс не найден
    - `405` - Метод не поддерживается
    - `500` - Внутренняя ошибка сервера
  version: 1.2.4
  contact:
    name: API Support
    url: https://github.com/ad/leads-core
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  # Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/adsky6/Leads/1.2.2
  - url: http://localhost:8080
    description: Development server
  - url: https://adsky.tplinkdns.com
    description: Production server

security:
  - BearerAuth: []

paths:
  # Health & Monitoring Endpoints
  /health:
    get:
      tags:
        - Monitoring
      summary: Проверка состояния сервиса
      description: Возвращает информацию о состоянии сервиса и его зависимостей
      security: []
      responses:
        '200':
          description: Состояние сервиса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: Проблемы с сервисом
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /metrics:
    get:
      tags:
        - Monitoring
      summary: Системные метрики
      description: Возвращает метрики производительности и использования ресурсов в
        формате Prometheus
      security: []
      responses:
        '200':
          description: Системные метрики в формате Prometheus
          content:
            text/plain:
              schema:
                type: string
                example: |
                  # HELP go_memstats_alloc_bytes Number of bytes allocated and still in use.
                  # TYPE go_memstats_alloc_bytes gauge
                  go_memstats_alloc_bytes 2.097152e+06

  # Widget Management Endpoints (API v1)
  /api/v1/widgets:
    get:
      tags:
        - Widgets
      summary: Получить список виджетов пользователя
      description: |
        Возвращает список виджетов текущего пользователя с поддержкой пагинации и фильтрации.
        
        ## Фильтрация
        
        Поддерживаются следующие типы фильтров:
        - **type** - фильтрация по типу виджета. Можно указать один тип или несколько через запятую
        - **isVisible** - фильтрация по состоянию видимости (true/false)
        - **search** - поиск по названию виджета (регистронезависимый, поиск по подстроке)
        
        ## Комбинирование фильтров
        
        Все фильтры применяются одновременно (логическое И). Примеры запросов:
        
        **Простые фильтры:**
        - `GET /api/v1/widgets?type=lead-form` - только формы
        - `GET /api/v1/widgets?isVisible=true` - только активные виджеты
        - `GET /api/v1/widgets?search=форма` - поиск по названию
        
        **Комбинированные фильтры:**
        - `GET /api/v1/widgets?type=lead-form&isVisible=true` - только активные формы
        - `GET /api/v1/widgets?type=banner,quiz&search=тест` - баннеры или викторины с "тест" в названии
        - `GET /api/v1/widgets?type=lead-form,banner&isVisible=true&search=форма` - активные формы и баннеры с "форма" в названии
        
        **С пагинацией:**
        - `GET /api/v1/widgets?type=lead-form&page=2&per_page=10` - вторая страница форм по 10 элементов
        
        ## Поведение при отсутствии результатов
        
        Если фильтры не дают результатов:
        - Возвращается пустой массив `widgets: []`
        - `meta.total` устанавливается в 0
        - `meta.has_more` устанавливается в false
        - HTTP статус остается 200 (успешный запрос)
        
        ## Производительность
        
        Фильтрация оптимизирована для минимального влияния на производительность:
        - Используются существующие Redis индексы для фильтрации по типу и видимости
        - Поиск по названию применяется только к уже отфильтрованным результатам
        - Пагинация применяется после фильтрации
      parameters:
        - name: page
          in: query
          description: Номер страницы
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: per_page
          in: query
          description: Количество элементов на странице
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: type
          in: query
          description: Фильтр по типу виджета. Можно указать несколько типов через запятую
          schema:
            type: string
            enum:
              - lead-form
              - banner
              - action
              - social-proof
              - live-interest
              - widget-tab
              - sticky-bar
              - quiz
              - wheelOfFortune
          examples:
            single:
              summary: Один тип
              value: lead-form
            multiple:
              summary: Несколько типов
              value: lead-form,banner,quiz
            all_forms:
              summary: Все типы форм
              value: lead-form,quiz,wheelOfFortune
            banners_only:
              summary: Только баннеры и уведомления
              value: banner,sticky-bar
        - name: isVisible
          in: query
          description: Фильтр по состоянию видимости виджета
          schema:
            type: boolean
          examples:
            active:
              summary: Только активные виджеты
              value: true
            inactive:
              summary: Только неактивные виджеты
              value: false
        - name: search
          in: query
          description: Поиск по названию виджета (регистронезависимый)
          schema:
            type: string
            minLength: 1
            maxLength: 255
          examples:
            simple:
              summary: Простой поиск
              value: форма
            complex:
              summary: Поиск с пробелами
              value: форма обратной связи
            partial_match:
              summary: Частичное совпадение
              value: банн
            case_insensitive:
              summary: Регистронезависимый поиск
              value: ФОРМА
            special_chars:
              summary: Поиск со спецсимволами
              value: "форма №1"
      responses:
        '200':
          description: Список виджетов
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      widgets:
                        type: array
                        items:
                          $ref: '#/components/schemas/Widget'
                      meta:
                        $ref: '#/components/schemas/Meta'
              examples:
                all_widgets:
                  summary: Все виджеты без фильтров
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                      - id: 5cf1754g-2e09-684c-08de-db09b76458ee
                        owner_id: user_456def
                        type: banner
                        name: Рекламный баннер
                        isVisible: false
                        created_at: '2024-01-14T09:15:00Z'
                        updated_at: '2024-01-15T11:30:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 2
                      has_more: false
                filtered_by_type:
                  summary: Фильтрация по типу lead-form
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 1
                      has_more: false
                filtered_by_visibility:
                  summary: Только активные виджеты
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 1
                      has_more: false
                search_results:
                  summary: Поиск по названию "форма"
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 1
                      has_more: false
                combined_filters:
                  summary: Комбинированные фильтры (type=lead-form&isVisible=true&search=форма)
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 1
                      has_more: false
                multiple_types:
                  summary: Фильтрация по нескольким типам (type=banner,quiz)
                  value:
                    widgets:
                      - id: 5cf1754g-2e09-684c-08de-db09b76458ee
                        owner_id: user_456def
                        type: banner
                        name: Рекламный баннер
                        isVisible: false
                        created_at: '2024-01-14T09:15:00Z'
                        updated_at: '2024-01-15T11:30:00Z'
                      - id: 6dg2865h-3f10-795d-19ef-ec10c87569ff
                        owner_id: user_456def
                        type: quiz
                        name: Викторина о продукте
                        isVisible: true
                        created_at: '2024-01-13T08:00:00Z'
                        updated_at: '2024-01-14T12:45:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 2
                      has_more: false
                inactive_widgets:
                  summary: Только неактивные виджеты (isVisible=false)
                  value:
                    widgets:
                      - id: 5cf1754g-2e09-684c-08de-db09b76458ee
                        owner_id: user_456def
                        type: banner
                        name: Рекламный баннер
                        isVisible: false
                        created_at: '2024-01-14T09:15:00Z'
                        updated_at: '2024-01-15T11:30:00Z'
                      - id: 7eh3976i-4g21-806e-20fg-fd21d98670gg
                        owner_id: user_456def
                        type: sticky-bar
                        name: Отключенная полоса
                        isVisible: false
                        created_at: '2024-01-12T16:30:00Z'
                        updated_at: '2024-01-13T10:15:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 2
                      has_more: false
                case_insensitive_search:
                  summary: Регистронезависимый поиск (search=ФОРМА)
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                      - id: 8fi4087j-5h32-917f-31gh-ge32e09781hh
                        owner_id: user_456def
                        type: lead-form
                        name: Контактная форма
                        isVisible: true
                        created_at: '2024-01-11T14:20:00Z'
                        updated_at: '2024-01-12T09:30:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 2
                      has_more: false
                complex_combination:
                  summary: Сложная комбинация фильтров (type=lead-form,banner&isVisible=true&search=форма)
                  value:
                    widgets:
                      - id: 4be0643f-1d98-573b-97cd-ca98a65347dd
                        owner_id: user_456def
                        type: lead-form
                        name: Форма обратной связи
                        isVisible: true
                        created_at: '2024-01-15T10:30:00Z'
                        updated_at: '2024-01-16T14:20:00Z'
                    meta:
                      page: 1
                      per_page: 20
                      total: 1
                      has_more: false
                pagination_with_filters:
                  summary: Пагинация с фильтрами (type=lead-form&page=2&per_page=1)
                  value:
                    widgets:
                      - id: 8fi4087j-5h32-917f-31gh-ge32e09781hh
                        owner_id: user_456def
                        type: lead-form
                        name: Контактная форма
                        isVisible: true
                        created_at: '2024-01-11T14:20:00Z'
                        updated_at: '2024-01-12T09:30:00Z'
                    meta:
                      page: 2
                      per_page: 1
                      total: 3
                      has_more: true
                no_results:
                  summary: Фильтры не дали результатов
                  value:
                    widgets: []
                    meta:
                      page: 1
                      per_page: 20
                      total: 0
                      has_more: false
                no_results_search:
                  summary: Поиск не дал результатов (search=несуществующий)
                  value:
                    widgets: []
                    meta:
                      page: 1
                      per_page: 20
                      total: 0
                      has_more: false
                no_results_type:
                  summary: Фильтр по несуществующему типу (type=nonexistent)
                  value:
                    widgets: []
                    meta:
                      page: 1
                      per_page: 20
                      total: 0
                      has_more: false
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags:
        - Widgets
      summary: Создать новый виджет
      description: Создает новый виджет для текущего пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWidgetRequest'
      responses:
        '201':
          description: Виджет создан
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Widget'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/v1/widgets/{id}:
    get:
      tags:
        - Widgets
      summary: Получить виджет по ID
      description: Возвращает информацию о конкретном виджете
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      responses:
        '200':
          description: Информация о виджете
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Widget'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Widgets
      summary: Обновить виджет
      description: Обновляет настройки существующего виджета
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWidgetRequest'
      responses:
        '200':
          description: Виджет обновлен
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Widget'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Widgets
      summary: Удалить виджет
      description: Удаляет виджет и все связанные с ним данные
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      responses:
        '204':
          description: Виджет удален
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/widgets/{id}/config:
    put:
      tags:
        - Widgets
      summary: Обновить конфигурацию виджета
      description: Обновляет конфигурацию существующего виджета
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWidgetConfigRequest'

      responses:
        '200':
          description: Виджет обновлен
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Widget'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/widgets/{id}/stats:
    get:
      tags:
        - Analytics
      summary: Получить статистику виджета
      description: Возвращает статистику просмотров, отправок и других событий для виджета
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      responses:
        '200':
          description: Статистика виджета
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/WidgetStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/widgets/{id}/submissions:
    get:
      tags:
        - Analytics
      summary: Получить отправки виджета
      description: Возвращает список всех отправок для конкретного виджета с
        поддержкой пагинации
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
        - name: page
          in: query
          description: Номер страницы
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Количество элементов на странице
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Список отправок
          content:
            application/json:
              schema:
                allOf:
                  - type: object
                    properties:
                      submissions:
                        type: array
                        items:
                          $ref: '#/components/schemas/Submission'
                      meta:
                        $ref: '#/components/schemas/Meta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/widgets/{id}/export:
    get:
      tags:
        - Analytics
      summary: Экспорт отправок виджета
      description: Экспортирует отправки конкретного виджета в различных форматах
        (CSV, JSON, XLSX)
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
        - name: format
          in: query
          description: Формат экспорта
          schema:
            type: string
            enum:
              - csv
              - json
              - xlsx
            default: json
        - name: from
          in: query
          description: Начальная дата для фильтрации (RFC3339 формат)
          schema:
            type: string
            format: date-time
            example: '2024-01-01T00:00:00Z'
        - name: to
          in: query
          description: Конечная дата для фильтрации (RFC3339 формат)
          schema:
            type: string
            format: date-time
            example: '2024-12-31T23:59:59Z'
      responses:
        '200':
          description: Файл экспорта
          content:
            text/csv:
              schema:
                type: string
                format: binary
            application/json:
              schema:
                type: string
                format: binary
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: Имя файла для скачивания
              schema:
                type: string
                example: attachment; filename="widget_submissions_2024-01-15.csv"
        '400':
          description: Неверные параметры экспорта
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/widgets/summary:
    get:
      tags:
        - Analytics
      summary: Общая сводка по виджетам
      description: Возвращает сводную статистику по всем виджетам пользователя
      responses:
        '200':
          description: Сводка по виджетам
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Response'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/WidgetsSummary'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Public Endpoints (не требуют аутентификации)
  /widgets/{id}/submit:
    post:
      tags:
        - Public
      summary: Отправить данные в виджет
      description: |
        Публичный эндпоинт для отправки данных в виджет.
        Не требует аутентификации и используется виджетами на внешних сайтах.
      security: []
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmissionRequest'
            examples:
              contactForm:
                summary: Отправка формы обратной связи
                value:
                  data:
                    name: Иван Иванов
                    email: ivan@example.com
                    phone: +7 (900) 123-45-67
                    message: Интересует ваш продукт
              newsletter:
                summary: Подписка через баннер
                value:
                  data:
                    email: user@example.com
      responses:
        '201':
          description: Данные отправлены
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Response'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Submission'
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Виджет отключен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /widgets/{id}/events:
    post:
      tags:
        - Public
      summary: Зарегистрировать событие виджета
      description: |
        Публичный эндпоинт для регистрации событий виджета (просмотры, закрытия).
        Не требует аутентификации и используется для аналитики.
      security: []
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор виджета
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventRequest'
            examples:
              view:
                summary: Регистрация просмотра
                value:
                  type: view
              close:
                summary: Регистрация закрытия
                value:
                  type: close
      responses:
        '204':
          description: Событие зарегистрировано
        '400':
          description: Неверный тип события
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Виджет отключен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  # Admin Panel
  /panel:
    get:
      tags:
        - Admin
      summary: Панель администратора
      description: |
        Веб-интерфейс для управления виджетами.
        Предоставляет пользовательский интерфейс для создания, просмотра и управления виджетами.
      security: []
      responses:
        '200':
          description: HTML страница панели администратора
          content:
            text/html:
              schema:
                type: string

  # User information Endpoints
  /api/v1/user:
    get:
      tags:
        - Users
      summary: Получить информацию о текущем пользователе
      description: Возвращает информацию о текущем пользователе, включая тарифный план
        и виджеты
      responses:
        '200':
          description: Информация о пользователе
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # User Management Endpoints
  /api/v1/users/{id}/ttl:
    put:
      tags:
        - Users
      summary: Обновить TTL для отправок пользователя
      description: |
        Обновляет время жизни (TTL) для всех отправок пользователя.
        Пользователь может обновлять TTL только для своих собственных данных.
      parameters:
        - name: id
          required: true
          in: path
          description: Уникальный идентификатор пользователя
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTTLRequest'
            examples:
              setTTL:
                summary: Установить TTL на 90 дней
                value:
                  ttl_days: 90
      responses:
        '200':
          description: TTL обновлен
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Response'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: TTL updated successfully
                          user_id:
                            type: string
                          ttl_days:
                            type: integer
        '400':
          description: Неверные параметры TTL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Нельзя обновлять TTL для других пользователей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации

  schemas:
    # Core Models
    Widget:
      type: object
      properties:
        id:
          type: string
          description: Уникальный идентификатор виджета
          example: 4be0643f-1d98-573b-97cd-ca98a65347dd
        owner_id:
          type: string
          description: ID владельца виджета
          example: user_456def
        type:
          type: string
          description: Тип виджета
          example: lead-form
          enum:
            - lead-form
            - banner
            - action
            - social-proof
            - live-interest
            - widget-tab
            - sticky-bar
            - quiz
            - wheelOfFortune
        name:
          type: string
          description: Название виджета
          example: Форма обратной связи
        isVisible:
          type: boolean
          description: Активен ли виджет
          example: true
        config:
          $ref: '#/components/schemas/WidgetConfig'
        created_at:
          type: string
          format: date-time
          description: Время создания
          example: '2024-01-15T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          description: Время последнего обновления
          example: '2024-01-16T14:20:00Z'
        stats:
          $ref: '#/components/schemas/WidgetStats'

    WidgetConfig:
      type: object

    Submission:
      type: object
      properties:
        id:
          type: string
          description: Уникальный идентификатор отправки
          example: submission_789ghi
        widget_id:
          type: string
          description: ID виджета
          example: 4be0643f-1d98-573b-97cd-ca98a65347dd
        data:
          type: object
          description: Данные отправки
          example:
            name: Иван Иванов
            email: ivan@example.com
            phone: +7 (900) 123-45-67
            message: Интересует ваш продукт
        created_at:
          type: string
          format: date-time
          description: Время отправки
          example: '2024-01-16T15:45:00Z'
        ttl:
          type: string
          description: Время жизни записи
          example: 2160h0m0s

    WidgetStats:
      type: object
      properties:
        views:
          type: integer
          format: int64
          description: Количество просмотров
          example: 1254
        submits:
          type: integer
          format: int64
          description: Количество отправок
          example: 87
        closes:
          type: integer
          format: int64
          description: Количество закрытий
          example: 156
        last_view:
          type: string
          format: date-time
          description: Время последнего просмотра
          example: '2024-01-16T15:30:00Z'

    WidgetsSummary:
      type: object
      properties:
        total_widgets:
          type: integer
          description: Общее количество виджетов
          example: 5
        active_widgets:
          type: integer
          description: Количество активных виджетов
          example: 4
        disabled_widgets:
          type: integer
          description: Количество отключенных виджетов
          example: 1
        total_views:
          type: integer
          description: Общее количество просмотров
          example: 3420
        total_submissions:
          type: integer
          description: Общее количество отправок
          example: 234

    User:
      type: object
      properties:
        id:
          type: string
          description: Уникальный идентификатор пользователя
          example: user_456def
        username:
          type: string
          description: Email пользователя
          example: ivan@example.com
        plan:
          type: string
          description: Тарифный план
          example: demo
          enum:
            - demo
            - free
            - pro

    # Request Models
    CreateWidgetRequest:
      type: object
      required:
        - type
        - name
        - isVisible
        - config
      properties:
        type:
          type: string
          description: Тип виджета
          example: lead-form
          enum:
            - lead-form
            - banner
            - action
            - social-proof
            - live-interest
            - widget-tab
            - sticky-bar
            - quiz
            - wheelOfFortune
        name:
          type: string
          description: Название виджета
          example: Форма обратной связи
          minLength: 1
          maxLength: 255
        isVisible:
          type: boolean
          description: Активен ли виджет
          example: true
        config:
          type: object
          description: Настройки полей виджета

    UpdateWidgetRequest:
      type: object
      properties:
        name:
          type: string
          description: Название виджета
          example: Новое название
          minLength: 1
          maxLength: 100
        isVisible:
          type: boolean
          description: Активен ли виджет
          example: false

    UpdateWidgetConfigRequest:
      type: object
      properties:
        config:
          type: object
          description: Настройки полей виджета

    SubmissionRequest:
      type: object
      required:
        - data
      properties:
        data:
          type: object
          description: Данные для отправки
          example:
            name: Иван Иванов
            email: ivan@example.com
            phone: +7 (900) 123-45-67
            message: Интересует ваш продукт

    EventRequest:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          description: Тип события
          example: view
          enum:
            - view
            - close

    UpdateTTLRequest:
      type: object
      required:
        - ttl_days
      properties:
        ttl_days:
          type: integer
          description: Количество дней для TTL
          minimum: 1
          maximum: 3650
          example: 90

    # Response Models
    Response:
      type: object
      properties:
        data:
          description: Данные ответа
        meta:
          $ref: '#/components/schemas/Meta'

    Meta:
      type: object
      properties:
        page:
          type: integer
          description: Текущая страница
          example: 1
        per_page:
          type: integer
          description: Элементов на странице
          example: 20
        total:
          type: integer
          description: Общее количество элементов
          example: 156
        has_more:
          type: boolean
          description: Есть ли еще страницы
          example: true

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Описание ошибки
          example: Validation failed
        details:
          description: Дополнительные детали ошибки
          example:
            field: email
            message: Invalid email format

    ValidationError:
      type: object
      properties:
        error:
          type: string
          example: Validation error
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: email
              message:
                type: string
                example: Invalid email format

    # Health & Metrics
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
          enum:
            - ok
            - error
        timestamp:
          type: string
          format: date-time
          example: '2024-01-16T10:30:00Z'
        uptime:
          type: string
          description: Время работы сервиса
          example: 72h30m15s
        services:
          type: object
          description: Состояние зависимых сервисов
          example:
            redis: ok
            database: ok
        metrics:
          $ref: '#/components/schemas/HealthMetrics'

    HealthMetrics:
      type: object
      properties:
        memory_usage_mb:
          type: number
          format: float
          description: Использование памяти в MB
          example: 45.2
        cpu_usage_percent:
          type: number
          format: float
          description: Использование CPU в процентах
          example: 12.5
        goroutines:
          type: integer
          description: Количество горутин
          example: 45

  responses:
    Unauthorized:
      description: Не авторизован
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: User not found

    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: Widget not found

    ValidationError:
      description: Ошибка валидации
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'
          example:
            error: Validation error
            details:
              - field: email
                message: Invalid email format
              - field: name
                message: Name is required

    InternalError:
      description: Внутренняя ошибка сервера
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: Internal server error

tags:
  - name: Widgets
    description: Управление виджетами - создание, обновление, удаление
  - name: Analytics
    description: Статистика и аналитика виджетов
  - name: Public
    description: Публичные эндпоинты для виджетов (без аутентификации)
  - name: Users
    description: Управление пользователями и их настройками
  - name: Admin
    description: Панель администратора для управления виджетами
  - name: Monitoring
    description: Мониторинг состояния системы и метрики