import{r as p,l as se,n as ae,j as C,c as n,e as H,S as I,d as k,D as h,o as oe,M as _,B as P,p as Z,q as ee,F as L,t as re,v as ce,L as de,k as ue}from"./main-DZtFyw_i.js";import{S as me,a as pe,u as he}from"./UpdateWidget-DzwVJC7g.js";import{A,S as j,a as Q,P as z,T as d,b as ge,C as N,M as q}from"./widget-BkhklL4o.js";import{u as ie}from"./useNotice-BOS9QkiF.js";const be=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",fill:"none",...e},p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.7071 2.29289C10.3166 1.90237 9.68342 1.90237 9.29289 2.29289L4.29289 7.29289C3.90237 7.68342 3.90237 8.31658 4.29289 8.70711L9.29289 13.7071C9.68342 14.0976 10.3166 14.0976 10.7071 13.7071C11.0976 13.3166 11.0976 12.6834 10.7071 12.2929L6.41421 8L10.7071 3.70711C11.0976 3.31658 11.0976 2.68342 10.7071 2.29289Z",fill:"currentColor"})),X=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",fill:"none",...e},p.createElement("path",{d:"M10 0L2 0C1.47005 0.00158273 0.962255 0.212794 0.587524 0.587524C0.212794 0.962255 0.00158273 1.47005 0 2L0 10C0.00158273 10.5299 0.212794 11.0377 0.587524 11.4125C0.962255 11.7872 1.47005 11.9984 2 12H3V10H2V2H10V3H12V2C11.9984 1.47005 11.7872 0.962255 11.4125 0.587524C11.0377 0.212794 10.5299 0.00158273 10 0Z",fill:"currentColor"}),p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.58752 4.58752C4.96225 4.21279 5.47005 4.00158 6 4H14C14.5299 4.00158 15.0377 4.21279 15.4125 4.58752C15.7872 4.96225 15.9984 5.47005 16 6V14C15.9984 14.5299 15.7872 15.0377 15.4125 15.4125C15.0377 15.7872 14.5299 15.9984 14 16H6C5.47005 15.9984 4.96225 15.7872 4.58752 15.4125C4.21279 15.0377 4.00158 14.5299 4 14V6C4.00158 5.47005 4.21279 4.96225 4.58752 4.58752ZM14 6H6V14H14V6Z",fill:"currentColor"})),ye=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",fill:"none",...e},p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 1C11.5288 1 11.9869 1.20949 12.3544 1.57991L14.4217 3.64718C14.7924 4.01786 15 4.47274 15 5C15 5.52385 14.794 6.06728 14.4217 6.43959L6.89021 13.9675C6.36661 14.5715 5.62438 14.9426 4.7564 15.0016H1V14.0016L1.00325 11.1647C1.06698 10.3758 1.43373 9.64229 1.98196 9.15991L9.56093 1.58101C9.93285 1.20718 10.4754 1 11 1ZM3.35157 10.6161C3.14601 10.7979 3.01885 11.0522 3 11.2452V13.0025L4.68578 13.004C4.95369 12.9851 5.20307 12.8604 5.42749 12.6054L9.80933 8.22354L7.77751 6.19172L3.35157 10.6161ZM9.19197 4.77776L11.2235 6.80933L12.9895 5.04339L10.9582 3.01212L9.19197 4.77776Z",fill:"currentColor"})),Ce=e=>p.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",fill:"none",...e},p.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 0L15 8L2 16V0ZM3.88767 12.6466L11.4384 8L3.88767 3.35343V12.6466Z",fill:"currentColor"})),ve=e=>{const{data:t,isLoading:i,error:u}=se(e);return{data:t,isLoading:i,error:u}},Ee=e=>{const t=e==null?void 0:e.config;return{...t,trigger:(t==null?void 0:t.trigger)||d.IMMEDIATE,position:(t==null?void 0:t.position)||z.CENTER,theme:(t==null?void 0:t.theme)||Q.LIGHT,size:(t==null?void 0:t.size)||j.SMALL,animation:(t==null?void 0:t.animation)||A.FADE,title:(t==null?void 0:t.title)||"",text:(t==null?void 0:t.text)||"",buttonText:(t==null?void 0:t.buttonText)||"",buttonUrl:(t==null?void 0:t.buttonUrl)||""}},Te=()=>{const{showError:e}=ie(),[t,{isLoading:i,error:u}]=ae();return{updateConfig:p.useCallback(async(m,v)=>{try{const l=ge(v);if(!l.success){const s=l.error.issues.map(a=>a.message).join(", ");throw new Error(`Ошибка валидации: ${s}`)}await t({id:m,config:v}).unwrap()}catch(l){throw console.error("Ошибка при обновлении конфигурации виджета:",l),e("Ошибка при сохранении конфигурации. Попробуйте еще раз.",l),l}},[t,e]),isLoading:i,error:u}},we="_tabs_15ni4_1",Se="_tabsHeader_15ni4_12",_e="_tabsList_15ni4_23",Le="_tab_15ni4_1",Ne="_active_15ni4_62",Oe="_disabled_15ni4_69",Me="_tabContent_15ni4_74",F={tabs:we,tabsHeader:Se,tabsList:_e,tab:Le,active:Ne,disabled:Oe,tabContent:Me},xe=({className:e,tabs:t,defaultActiveTab:i,onTabChange:u})=>{var s;const[g,m]=p.useState(i||((s=t[0])==null?void 0:s.id)||""),v=p.useMemo(()=>t.find(a=>a.id===g),[t,g]),l=a=>{const o=t.find(b=>b.id===a);o!=null&&o.disabled||(m(a),u==null||u(a))};return t.length?C("div",{className:H(F.tabs,{},[e]),children:[n("div",{className:F.tabsHeader,children:n("div",{className:F.tabsList,children:t.map(a=>n("button",{className:H(F.tab,{[F.active]:a.id===g,[F.disabled]:a.disabled},[]),disabled:a.disabled,onClick:()=>l(a.id),type:"button",children:a.label},a.id))})}),n("div",{className:F.tabContent,children:v==null?void 0:v.content})]}):null},Ae="_tabCode_n9u6t_1",Ie="_codeSection_n9u6t_9",ke="_codeSectionTitle_n9u6t_24",fe="_codeOutput_n9u6t_33",Pe="_codeOutputText_n9u6t_49",O={tabCode:Ae,codeSection:Ie,codeSectionTitle:ke,codeOutput:fe,codeOutputText:Pe},Fe=p.memo(({widget:e,formData:t})=>{const{showSuccess:i,showError:u}=ie(),g=()=>e?{...e.config,type:e.type,...t}:t,m=()=>{const o={...g()};return delete o.singleton,`<script src="https://modal.workerdev.ru/nhleads.min.js"><\/script>
<script>
    const modal = new NHLeads(`+JSON.stringify(o)+`);
<\/script>`},v=()=>{const o={...g()};return delete o.singleton,`// Инициализация модального окна NHLeads
const modal = new NHLeads(`+JSON.stringify(o)+`);

// Дополнительные методы управления:
// modal.show();     // Показать модальное окно
// modal.hide();     // Скрыть модальное окно
// modal.destroy();  // Удалить модальное окно

// Обработка событий:
modal.on('show', function() {
    console.log('Модальное окно показано');
});

modal.on('hide', function() {
    console.log('Модальное окно скрыто');
});

modal.on('submit', function(data) {
    console.log('Форма отправлена:', data);
    // Здесь ваш код обработки данных формы
});`},l=()=>{const o={...g()};return delete o.singleton,JSON.stringify(o)},s=async a=>{let o="";switch(a){case"html":o=m();break;case"js":o=v();break;case"json":o=l();break}try{await navigator.clipboard.writeText(o),i("Код скопирован в буфер обмена")}catch(b){console.error("Ошибка копирования: ",b),u("Не удалось скопировать код. Выделите текст вручную.")}};return C("div",{className:O.tabCode,children:[C("div",{className:O.codeSection,children:[n("h3",{className:O.codeSectionTitle,children:"HTML код для встраивания:"}),n("div",{className:O.codeOutput,children:n("pre",{className:O.codeOutputText,children:m()})}),n(k,{appearance:"secondary",icon:X,onClick:()=>s("html"),size:I.small,type:"button",children:"Скопировать HTML"})]}),C("div",{className:O.codeSection,children:[n("h3",{className:O.codeSectionTitle,children:"JavaScript код инициализации:"}),n("div",{className:O.codeOutput,children:n("pre",{className:O.codeOutputText,children:v()})}),n(k,{appearance:"secondary",icon:X,onClick:()=>s("js"),size:I.small,type:"button",children:"Скопировать JavaScript"})]}),C("div",{className:O.codeSection,children:[n("h3",{className:O.codeSectionTitle,children:"JSON конфигурация:"}),n("div",{className:O.codeOutput,children:n("pre",{className:O.codeOutputText,children:l()})}),n(k,{appearance:"secondary",icon:X,onClick:()=>s("json"),size:I.small,type:"button",children:"Скопировать JSON"})]})]})}),Re="_widgetEditForm_1f1c8_1",He="_contentForm_1f1c8_7",Ve="_tabDesign_1f1c8_19",Ue="_submitSection_1f1c8_30",ze="_error_1f1c8_35",Be="_yandexMetrica_1f1c8_41",Je="_googleAnalytics_1f1c8_42",M={widgetEditForm:Re,contentForm:He,tabDesign:Ve,submitSection:Ue,error:ze,yandexMetrica:Be,googleAnalytics:Je},We=[{id:"title",label:"Заголовок",component:h,placeholder:"Введите заголовок виджета"},{id:"text",label:"Текст",component:oe,placeholder:"Введите текст виджета"},{id:"buttonText",label:"Текст кнопки",component:h,placeholder:"Введите текст кнопки"},{id:"buttonUrl",label:"URL кнопки",component:h,placeholder:"https://example.com"}],je=({formData:e,handleInputChange:t})=>n("div",{className:M.contentForm,children:We.map(i=>n("div",{className:M.formGroup,children:n(_,{...i,onChange:t(i.id),value:e[i.id]??""})},i.id))}),qe=[{name:Q.LIGHT,label:"Светлая"},{name:Q.DARK,label:"Темная"}],Ge=[{name:j.SMALL,label:"Маленький"},{name:j.MEDIUM,label:"Средний"},{name:j.LARGE,label:"Большой"}],Xe=[{name:z.CENTER,label:"Центр"},{name:z.TOP_LEFT,label:"Сверху слева"},{name:z.TOP_RIGHT,label:"Сверху справа"},{name:z.BOTTOM_LEFT,label:"Снизу слева"},{name:z.BOTTOM_RIGHT,label:"Снизу справа"}],Ze=[{name:A.FADE,label:"Фейд"},{name:A.SLIDE,label:"Слайд"},{name:A.ZOOM,label:"Зум"},{name:A.SLIDE_UP,label:"Слайд вверх"},{name:A.SLIDE_DOWN,label:"Слайд вниз"},{name:A.SLIDE_LEFT,label:"Слайд влево"},{name:A.SLIDE_RIGHT,label:"Слайд вправо"},{name:A.BOUNCE,label:"Бонуз"},{name:A.FLIP,label:"Флип"}],Qe=({formData:e,handleSelectChange:t})=>C("div",{className:H(M.tabDesign,{},[M.contentForm]),children:[n(P,{label:"Тема",list:qe,onChange:t("theme"),size:"small",value:e.theme}),n(P,{label:"Размер",list:Ge,onChange:t("size"),size:"small",value:e.size}),n(P,{label:"Положение",list:Xe,onChange:t("position"),size:"small",value:e.position}),n(P,{label:"Анимация",list:Ze,onChange:t("animation"),size:"small",value:e.animation})]}),Ye=[{id:"counterId",label:"ID счетчика Яндекс Метрики",component:h},{id:"show",label:"Цель при показе виджета",component:h},{id:"hide",label:"Цель при скрытии виджета",component:h},{id:"submit",label:"Цель при отправке данных",component:h},{id:"click",label:"Цель при клике на кнопку",component:h}],Ke=[{id:"measurementId",label:"Measurement ID (G-XXXXXXXXXX)",component:h},{id:"show",label:"Событие при показе виджета",component:h},{id:"hide",label:"Событие при скрытии виджета",component:h},{id:"submit",label:"Событие при отправке данных",component:h},{id:"click",label:"Событие при клике на кнопку",component:h}],$e=({formData:e,onFormDataChange:t})=>{const i=(l,s)=>{var a,o,b,T,y,w;return l==="yandexMetrica"?s==="counterId"?((a=e.yandexMetrica)==null?void 0:a[s])||"":((b=(o=e.yandexMetrica)==null?void 0:o.goals)==null?void 0:b[s])||"":l==="googleAnalytics"?s==="measurementId"?((T=e.googleAnalytics)==null?void 0:T[s])||"":((w=(y=e.googleAnalytics)==null?void 0:y.events)==null?void 0:w[s])||"":""},u=l=>s=>{var b,T,y;const a=s.target.value,o={...e,yandexMetrica:{counterId:l==="counterId"?a:((b=e.yandexMetrica)==null?void 0:b.counterId)||"",goals:l==="counterId"?{...((T=e.yandexMetrica)==null?void 0:T.goals)||{}}:{...((y=e.yandexMetrica)==null?void 0:y.goals)||{},[l]:a}}};t(o)},g=l=>s=>{var b,T,y;const a=s.target.value,o={...e,googleAnalytics:{measurementId:l==="measurementId"?a:((b=e.googleAnalytics)==null?void 0:b.measurementId)||"",events:l==="measurementId"?{...((T=e.googleAnalytics)==null?void 0:T.events)||{}}:{...((y=e.googleAnalytics)==null?void 0:y.events)||{},[l]:a}}};t(o)},m=()=>{const l=!e.yandexMetrica,s={...e};l?s.yandexMetrica={counterId:"",goals:{show:"",hide:"",submit:"",click:""}}:delete s.yandexMetrica,t(s)},v=()=>{const l=!e.googleAnalytics,s={...e};l?s.googleAnalytics={measurementId:"",events:{show:"",hide:"",submit:"",click:""}}:delete s.googleAnalytics,t(s)};return C("div",{className:H(M.tabIntegrations,{},[M.contentForm]),children:[C("div",{className:M.yandexMetrica,children:[n(Z,{checked:!!e.yandexMetrica,id:"yandex-metrica",label:"Яндекс Метрика",onClick:m,size:"small"}),e.yandexMetrica&&n(L,{children:Ye.map(l=>ee(_,{...l,key:l.id,onChange:u(l.id),value:i("yandexMetrica",l.id)}))})]}),C("div",{className:M.googleAnalytics,children:[n(Z,{checked:!!e.googleAnalytics,id:"google-analytics",label:"Google Analytics",onClick:v,size:"small"}),e.googleAnalytics&&n(L,{children:Ke.map(l=>ee(_,{...l,key:l.id,onChange:g(l.id),value:i("googleAnalytics",l.id)}))})]})]})},De=[{name:d.IMMEDIATE,label:"Сразу"},{name:d.DELAY,label:"С задержкой"},{name:d.SCROLL,label:"Скролл"},{name:d.CLICK,label:"Клик"},{name:d.MOUSELEAVE,label:"Уход мыши"},{name:d.INACTIVE,label:"Неактивность"},{name:d.BEFOREUNLOAD,label:"Закрытие страницы"},{name:d.SESSION_TIME,label:"Время сессии"},{name:d.VISIT_COUNT,label:"Количество посещений"},{name:d.FOCUSOUT,label:"Потеря фокуса"},{name:d.ELEMENT,label:"При появлении элемента"},{name:d.ONCE,label:"Один раз"}],et=[{name:N.ALL,label:"На всех страницах"},{name:N.SPECIFIC,label:"На конкретной странице"},{name:N.STARTS_WITH,label:"Начинается с URL"},{name:N.QUERY,label:"Запросы"},{name:N.HASH,label:"Хеш"},{name:N.SELECTOR,label:"Селектор на странице"},{name:N.NO_SELECTOR,label:"Без селектора на странице"}],te=[{name:q.EXACT,label:"Точное совпадение"},{name:q.CONTAINS,label:"Содержит"}],le={[d.IMMEDIATE]:[],[d.DELAY]:["delay"],[d.SCROLL]:["scrollThreshold"],[d.CLICK]:["clickSelector"],[d.MOUSELEAVE]:[],[d.INACTIVE]:["inactiveTimeout"],[d.BEFOREUNLOAD]:[],[d.SESSION_TIME]:["sessionTimeDelay"],[d.FOCUSOUT]:[],[d.ELEMENT]:["elementSelector","elementThreshold"],[d.ONCE]:[],[d.VISIT_COUNT]:["visitCountTrigger"]},tt=()=>Object.values(le).flat(),nt=({formData:e,handleInputChange:t,handleSelectChange:i,onFormDataChange:u})=>{var B,J,W;const g=c=>{const r=tt(),S=le[c]||[],x=r.filter(U=>!S.includes(U)),V={...e};V.trigger=c,x.forEach(U=>{delete V[U]}),u(V)},m=c=>{const r={...e};r.displayConditions={enabled:!0,type:c},u(r)},v=()=>{var S;const c=!((S=e.displayConditions)!=null&&S.enabled),r={...e};c?r.displayConditions={enabled:c,type:N.ALL}:delete r.displayConditions,u(r)},l=()=>{switch(e.trigger){case d.IMMEDIATE:return null;case d.DELAY:return n(L,{children:n(_,{component:h,id:"delay",label:"Задержка, сек.",max:60,min:0,onChange:c=>t("delay")(Number(c.target.value)),type:"number",value:e.delay||""})});case d.SCROLL:return n(L,{children:n(_,{component:h,id:"scrollThreshold",label:"Прокрутка, %",max:100,min:0,onChange:c=>t("scrollThreshold")(Number(c.target.value)),type:"number",value:e.scrollThreshold||""})});case d.CLICK:return n(L,{children:n(_,{component:h,id:"clickSelector",label:"Селектор",onChange:t("clickSelector"),placeholder:"Например, .my-button",value:e.clickSelector||""})});case d.MOUSELEAVE:return null;case d.INACTIVE:return n(L,{children:n(_,{component:h,id:"inactiveTimeout",label:"Время, сек.",max:120,min:0,onChange:c=>t("inactiveTimeout")(Number(c.target.value)),type:"number",value:e.inactiveTimeout||""})});case d.BEFOREUNLOAD:return null;case d.SESSION_TIME:return n(L,{children:n(_,{component:h,id:"sessionTimeDelay",label:"Время, сек.",max:120,min:0,onChange:c=>t("sessionTimeDelay")(Number(c.target.value)),type:"number",value:e.sessionTimeDelay||""})});case d.FOCUSOUT:return null;case d.ELEMENT:return C(L,{children:[n(_,{component:h,id:"elementSelector",label:"Селектор",onChange:t("elementSelector"),placeholder:"Например, .my-element",value:e.elementSelector||""}),n(_,{component:h,id:"elementThreshold",label:"Процент видимости",max:100,min:0,onChange:c=>t("elementThreshold")(Number(c.target.value)),type:"number",value:e.elementThreshold||""})]});case d.ONCE:return null;case d.VISIT_COUNT:return n(L,{children:n(_,{component:h,id:"visitCountTrigger",label:"Количество посещений",max:100,min:0,onChange:c=>t("visitCountTrigger")(Number(c.target.value)),type:"number",value:e.visitCountTrigger||""})});default:return null}},s=(c,r)=>{const S={...e};S.displayConditions&&(S.displayConditions[r]=c.target.value.split(",").map(x=>x.trim())),u(S)},[a,o]=p.useState("");p.useEffect(()=>{var r;const c=(r=e.displayConditions)==null?void 0:r.queryParams;c&&o(JSON.stringify(c))},[]);const[b,T]=p.useState(null),y=c=>{const r=c.target.value;if(o(r),T(null),!r.trim()){const S={...e};S.displayConditions={...S.displayConditions,queryParams:{}},u(S);return}},w=()=>{var r;if(a!==void 0)return a;const c=(r=e.displayConditions)==null?void 0:r.queryParams;return c?JSON.stringify(c):""},E=()=>{const c=w();if(c.trim())try{const r=JSON.parse(c),S=JSON.stringify(r,null,2);o(S);const x={...e};x.displayConditions={...x.displayConditions,queryParams:r},u(x)}catch(r){console.error(r),T("Некорректный JSON формат. Проверьте правильность ввода.")}},f=()=>{var c,r,S,x,V,U,Y,K,$,D;switch((c=e.displayConditions)==null?void 0:c.type){case N.ALL:return null;case N.SPECIFIC:return C(L,{children:[n(_,{component:h,id:"pages",label:"Пути страниц (через запятую)",onChange:G=>s(G,"pages"),placeholder:"Например, /page, /page2",value:((S=(r=e.displayConditions)==null?void 0:r.pages)==null?void 0:S.join(", "))||""}),n(P,{label:"Режим совпадения",list:te,onChange:i("displayConditions","matchMode"),value:((x=e.displayConditions)==null?void 0:x.matchMode)||q.EXACT})]});case N.STARTS_WITH:return n(_,{component:h,id:"pathPrefix",label:"Префикс пути",onChange:t("displayConditions","pathPrefix"),placeholder:"Например, /page",value:((V=e.displayConditions)==null?void 0:V.pathPrefix)||""});case N.QUERY:return n(L,{children:n(_,{component:h,error:b,id:"queryParams",label:"Объект в формате JSON, множественные значения указываются в массиве",onBlur:E,onChange:y,placeholder:'{"utm_source": "google", "promo": ["sale2024", "sale2025"]}',value:w()})});case N.HASH:return C(L,{children:[n(_,{component:h,id:"hashParams",label:"Хеш параметры (через запятую)",onChange:G=>s(G,"hashParams"),placeholder:"Например, hash1, hash2",value:((Y=(U=e.displayConditions)==null?void 0:U.hashParams)==null?void 0:Y.join(", "))||""}),n(P,{label:"Режим совпадения",list:te,onChange:i("displayConditions","matchMode"),value:((K=e.displayConditions)==null?void 0:K.matchMode)||q.EXACT})]});case N.SELECTOR:return n(L,{children:n(_,{component:h,id:"selector",label:"Селектор",onChange:t("displayConditions","selector"),placeholder:"Например, .my-element",value:(($=e.displayConditions)==null?void 0:$.selector)||""})});case N.NO_SELECTOR:return n(L,{children:n(_,{component:h,id:"noSelector",label:"Селектор",onChange:t("displayConditions","selector"),placeholder:"Например, .my-element",value:((D=e.displayConditions)==null?void 0:D.selector)||""})});default:return null}};return C("div",{className:M.contentForm,children:[n(P,{label:"Условие показа",list:De,onChange:g,value:e.trigger}),l(),n(Z,{checked:!!((B=e.displayConditions)!=null&&B.enabled),id:"displayConditions",label:"Условия показа",onClick:v,size:"small"}),((J=e.displayConditions)==null?void 0:J.enabled)&&C(L,{children:[n(P,{label:"Условие показа",list:et,onChange:m,value:((W=e.displayConditions)==null?void 0:W.type)||N.ALL}),f()]})]})},it=p.memo(({className:e,widget:t,formData:i,onFormDataChange:u,isDirty:g,onSaveSuccess:m})=>{const{updateConfig:v,isLoading:l,error:s}=Te(),a=(y,w)=>E=>{const f={...i,[y]:w?{...i[y],[w]:typeof E=="number"?E:E.target.value}:typeof E=="number"?E:E.target.value};u(f)},o=(y,w)=>E=>{const f={...i,[y]:w?{...i[y],[w]:E}:E};u(f)},b=async y=>{if(y.preventDefault(),!!t)try{const w={...i};await v(t.id,w),m()}catch(w){console.error("Ошибка при сохранении конфигурации:",w)}},T=[{id:"content",label:"Контент",content:n(je,{formData:i,handleInputChange:a})},{id:"design",label:"Дизайн",content:n(Qe,{formData:i,handleSelectChange:o})},{id:"behavior",label:"Поведение",content:n(nt,{formData:i,handleInputChange:a,handleSelectChange:o,onFormDataChange:u})},{id:"integrations",label:"Интеграции*",content:n($e,{formData:i,onFormDataChange:u})},{id:"embed",label:"Код для встраивания",content:n(Fe,{formData:i,widget:t})}];return C("form",{className:H(M.widgetEditForm,{},[e]),onSubmit:b,children:[n(xe,{tabs:T}),C("div",{className:M.submitSection,children:[s&&n("p",{className:M.error,children:"Ошибка при сохранении конфигурации. Попробуйте еще раз."}),g&&n(k,{appearance:"primary",disabled:l,size:I.large,type:"submit",children:l?"Сохранение...":"Сохранить"})]})]})}),lt=(e,t,i)=>{const u={title:e.title||t,text:e.text||"",buttonText:e.buttonText||"ОК",buttonUrl:e.buttonUrl||null,theme:e.theme||"light",size:e.size||"medium",position:e.position||"center",animation:e.animation||"fade",trigger:"immediate",showCloseButton:e.showCloseButton!==!1,showOverlay:e.showOverlay!==!1,closeOnOverlayClick:e.closeOnOverlayClick!==!1,closeOnEscape:e.closeOnEscape!==!1,singleton:!1},g=st(e,i);return{...u,type:i,...g}};function st(e,t){const i={};switch(t){case"lead-form":i.nameLabel=e.nameLabel||"Имя",i.contactLabel=e.contactLabel||"Телефон или Email",i.submitButtonText=e.submitButtonText||"Отправить",i.submitButtonUrl=e.submitButtonUrl||null;break;case"social-proof":e.socialProof&&(i.socialProof=e.socialProof);break;case"live-interest":e.liveInterest&&(i.liveInterest=e.liveInterest);break;case"widget-tab":e.widgetTab&&(i.widgetTab=e.widgetTab);break;case"sticky-bar":e.stickyBar&&(i.stickyBar=e.stickyBar);break;case"quiz":e.quiz&&(i.quiz=e.quiz);break;case"wheelOfFortune":e.wheelOfFortune&&(i.wheelOfFortune=e.wheelOfFortune);break}return e.yandexMetrica&&(i.yandexMetrica=e.yandexMetrica),e.googleAnalytics&&(i.googleAnalytics=e.googleAnalytics),i}const at=()=>{const e=p.useRef(null),t=p.useCallback(async(g,m,v)=>{try{if(e.current){try{e.current.destroy()}catch(a){console.warn("Ошибка при закрытии предыдущего модального окна:",a)}e.current=null}if(typeof window>"u"||!window.NHLeads)throw new Error("Библиотека NHLeads недоступна. Убедитесь, что она загружена на странице.");const l=window.NHLeads,s=lt(g,m,v);e.current=new l({...s,id:`preview-${Date.now()}`,singleton:!1}),e.current.on("show",()=>{console.log("Модальное окно предпросмотра показано")}),e.current.on("hide",()=>{console.log("Модальное окно предпросмотра скрыто"),e.current=null}),e.current.on("submit",a=>{console.log("Отправка формы в предпросмотре:",a)}),e.current.on("click",a=>{console.log("Клик по кнопке в предпросмотре:",a)}),e.current.show()}catch(l){throw console.error("Ошибка при создании предпросмотра виджета:",l),l}},[]),i=p.useCallback(()=>{if(e.current)try{e.current.hide()}catch(g){console.warn("Ошибка при скрытии модального окна:",g)}},[]),u=p.useCallback(()=>{if(e.current)try{e.current.destroy(),e.current=null}catch(g){console.warn("Ошибка при уничтожении модального окна:",g)}},[]);return{showPreview:t,hidePreview:i,destroyPreview:u}},ot="_header_ipigr_1",rt="_titleContainer_ipigr_6",ct="_viewButton_ipigr_11",dt="_title_ipigr_6",ut="_titleInput_ipigr_31",mt="_type_ipigr_49",pt="_buttons_ipigr_59",R={header:ot,titleContainer:rt,viewButton:ct,title:dt,titleInput:ut,type:mt,buttons:pt},ht=p.memo(({className:e,type:t,name:i,isActive:u,isVisibilityLoading:g,config:m,changeVisibility:v,changeName:l})=>{const[s,a]=p.useState(!1),[o,b]=p.useState(i),T=p.useRef(null),{showPreview:y}=at();p.useEffect(()=>{b(i)},[i]),p.useEffect(()=>{s&&T.current&&(T.current.focus(),T.current.select())},[s]);const w=()=>{a(!0),b(i)},E=()=>{a(!1),b(i)},f=async()=>{const r=o.trim();if(r){if(r===i){a(!1);return}try{await l(r),a(!1)}catch(S){console.error("Ошибка при сохранении названия:",S)}}},B=r=>{r.key==="Enter"?f():r.key==="Escape"&&E()},J=r=>{b(r.target.value)},W=async()=>{try{await y(m,i,t)}catch(r){console.error("Ошибка при показе предпросмотра:",r)}},c=!o.trim();return C("div",{className:H(R.header,{},[e]),children:[n("span",{className:R.type,children:t}),C("div",{className:R.titleContainer,children:[s?n("div",{className:R.titleInput,onKeyDown:B,children:n(h,{maxLength:100,onChange:J,placeholder:"Введите название",value:o})}):n("h1",{className:R.title,"data-testid":"widget-name",children:i}),C("div",{className:R.buttons,children:[n(k,{appearance:"tertiary",disabled:g,icon:u?me:pe,onClick:()=>v(!u),size:I.medium}),s?C(L,{children:[n(k,{appearance:"tertiary",onClick:E,size:I.medium,children:"Отмена"}),n(k,{appearance:"secondary","data-testid":"save-name-button",disabled:c,onClick:f,size:I.medium,children:"Сохранить"})]}):n(re,{placement:"top-center",text:"Изменить название",children:n(k,{appearance:"secondary","data-testid":"change-name-button",icon:ye,onClick:w,size:I.medium})}),n(k,{appearance:"primary",className:R.viewButton,"data-testid":"preview-button",icon:Ce,id:"view-button",onClick:W,size:I.medium,children:"Просмотр"})]})]})]})}),gt="_edit_fwsb5_1",bt="_back_fwsb5_7",ne={edit:gt,back:bt},Tt=p.memo(({className:e,...t})=>{const{id:i}=ce(),{updateWidgetData:u,isLoading:g}=he(),{data:m,isLoading:v,error:l}=ve(i),[s,a]=p.useState(null),[o,b]=p.useState(null);p.useEffect(()=>{if(m){const E=Ee(m);a(E),b(E)}},[m]);const T=s&&o?JSON.stringify(s)!==JSON.stringify(o):!1,y=p.useCallback(()=>{b(s)},[s]);if(v)return n("div",{children:"Загрузка..."});if(l)return n("div",{children:"Ошибка"});if(!m)return n("div",{children:"Виджет не найден"});const w=s?{...m.config,...s}:m.config;return C("div",{className:H(ne.edit,{},[e]),...t,children:[C(de,{className:ne.back,to:ue,children:[n(be,{}),"Сводка"]}),n(ht,{changeName:E=>u(m.id,m==null?void 0:m.isActive,E),changeVisibility:E=>u(m.id,E,m.name),config:w,isActive:m.isActive,isVisibilityLoading:g,name:m.name,type:m.type}),s&&n(it,{formData:s,isDirty:T,onFormDataChange:a,onSaveSuccess:y,widget:m})]})});export{Tt as default};
